<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposal Jigsaw Puzzle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #ffe6f2;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #d63384;
            font-size: 1.5em;
        }
        p {
            font-size: 1em;
        }
        #puzzle-container {
            display: inline-block;
            position: relative;
            width: 300px;
            height: 300px;
            border: 2px solid #d63384;
            margin: 20px auto;
            background-color: #fff;
        }
        .puzzle-piece {
            position: absolute;
            width: 100px;
            height: 100px;
            background-size: 300px 300px;
            cursor: grab;
            border: 1px solid #ccc;
            transition: all 0.2s;
            user-select: none;
        }
        .puzzle-piece:hover {
            opacity: 0.8;
        }
        .puzzle-piece.dragging {
            opacity: 0.5;
            z-index: 10;
        }
        #message {
            display: none;
            font-size: 24px;
            color: #d63384;
            margin-top: 20px;
        }
        #audio {
            display: none;
        }
        button {
            padding: 10px 20px;
            background-color: #d63384;
            color: white;
            border: none;
            cursor: pointer;
            margin: 10px;
            font-size: 1em;
        }
        button:hover {
            background-color: #b02a6b;
        }
        /* Mobile responsiveness */
        @media (max-width: 600px) {
            #puzzle-container {
                width: 225px;
                height: 225px;
            }
            .puzzle-piece {
                width: 75px;
                height: 75px;
            }
            h1 {
                font-size: 1.2em;
            }
            #message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <h1>Will You Solve This Puzzle for a Special Message?</h1>
    <p>Drag the pieces to their correct positions to complete the puzzle and reveal the proposal!</p>
    <div id="puzzle-container"></div>
    <button id="shuffle-btn">Shuffle Puzzle</button>
    <div id="message">Will you be my forever valentine, Bean?</div>
    <audio id="audio" controls loop>
        <!-- Replace 'your-song.mp3' with the path to your song file. -->
        <source src="your-song.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        const container = document.getElementById('puzzle-container');
        const message = document.getElementById('message');
        const audio = document.getElementById('audio');
        const shuffleBtn = document.getElementById('shuffle-btn');

        // Replace 'your-image.jpg' with the path to your provided picture.
        const imageSrc = 'your-image.jpg'; // Ensure the image is 300x300 or square for best fit.

        const gridSize = 3; // 3x3 grid for easier solving
        let pieceSize = 100; // Will be adjusted for mobile
        let pieces = [];
        let correctPositions = [];

        // Adjust for mobile
        function adjustForMobile() {
            if (window.innerWidth <= 600) {
                pieceSize = 75;
                container.style.width = '225px';
                container.style.height = '225px';
            } else {
                pieceSize = 100;
                container.style.width = '300px';
                container.style.height = '300px';
            }
        }

        // Create puzzle pieces
        function createPuzzle() {
            adjustForMobile();
            container.innerHTML = '';
            pieces = [];
            correctPositions = [];
            for (let i = 0; i < gridSize * gridSize; i++) {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.style.backgroundImage = `url(${imageSrc})`;
                piece.style.backgroundPosition = `-${(i % gridSize) * pieceSize}px -${Math.floor(i / gridSize) * pieceSize}px`;
                piece.dataset.index = i;
                piece.draggable = true;
                piece.addEventListener('dragstart', dragStart);
                piece.addEventListener('dragend', dragEnd);
                container.addEventListener('dragover', dragOver);
                container.addEventListener('drop', drop);
                container.appendChild(piece);
                pieces.push(piece);
                correctPositions.push({ x: (i % gridSize) * pieceSize, y: Math.floor(i / gridSize) * pieceSize });
            }
            shufflePuzzle();
        }

        // Shuffle the puzzle
        function shufflePuzzle() {
            // Randomize positions
            for (let i = pieces.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pieces[i], pieces[j]] = [pieces[j], pieces[i]];
            }
            updatePositions();
            message.style.display = 'none';
            audio.pause();
        }

        // Update piece positions
        function updatePositions() {
            for (let i = 0; i < pieces.length; i++) {
                const x = (i % gridSize) * pieceSize;
                const y = Math.floor(i / gridSize) * pieceSize;
                pieces[i].style.left = `${x}px`;
                pieces[i].style.top = `${y}px`;
            }
        }

        // Drag and drop handlers
        let draggedPiece = null;

        function dragStart(e) {
            draggedPiece = e.target;
            e.target.classList.add('dragging');
        }

        function dragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function dragOver(e) {
            e.preventDefault();
        }

        function drop(e) {
            e.preventDefault();
            if (draggedPiece) {
                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left - pieceSize / 2;
                const y = e.clientY - rect.top - pieceSize / 2;
                // Snap to grid
                const gridX = Math.round(x / pieceSize) * pieceSize;
                const gridY = Math.round(y / pieceSize) * pieceSize;
                draggedPiece.style.left = `${Math.max(0, Math.min(gridX, (gridSize - 1) * pieceSize))}px`;
                draggedPiece.style.top = `${Math.max(0, Math.min(gridY, (gridSize - 1) * pieceSize))}px`;
                checkWin();
            }
        }

        // Check if puzzle is solved
        function checkWin() {
            let solved = true;
            for (let i = 0; i < pieces.length; i++) {
                const piece = pieces[i];
                const index = parseInt(piece.dataset.index);
                const expectedX = correctPositions[index].x;
                const expectedY = correctPositions[index].y;
                const currentX = parseFloat(piece.style.left || 0);
                const currentY = parseFloat(piece.style.top || 0);
                if (Math.abs(currentX - expectedX) > 10 || Math.abs(currentY - expectedY) > 10) {
                    solved = false;
                    break;
                }
            }
            if (solved) {
                message.style.display = 'block';
                audio.play();
            }
        }

        // Event listeners
        shuffleBtn.addEventListener('click', shufflePuzzle);
        window.addEventListener('resize', adjustForMobile);

        // Initialize
        createPuzzle();
    </script>
</body>
</html>